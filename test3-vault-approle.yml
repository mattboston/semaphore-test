---
# Example playbook using Vault with AppRole authentication
# This is typically used in Semaphore UI or CI/CD environments
#
# Requirements:
#   - vault-approle-eng.json file with AppRole credentials for eng namespace
#   - vault-approle-fin.json file with AppRole credentials for fin namespace
#
# AppRole JSON file format:
# {
#   "vault_namespace": "eng",
#   "role_id": "your-role-id",
#   "secret_id": "your-secret-id",
#   "auth_mount_path": "auth/approle"
# }
#
# Run with:
#   ansible-playbook -i inventories/test.ini test3-vault-approle.yml -l testbed-ca -u flipside -e "semaphore=true"

- name: Vault authentication and secret retrieval (AppRole)
  hosts: all
  vars:
    test3_eng_approle_creds: "{{ lookup('file', '/etc/semaphore/vault-approle-eng.json') | from_json }}"
    test3_fin_approle_creds: "{{ lookup('file', '/etc/semaphore/vault-approle-fin.json') | from_json }}"
  roles:
    - role: test3 # Fetch secrets from eng/blockchain and fin/treasury (uses vault role internally)
